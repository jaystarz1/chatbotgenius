<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NATO M&S Workflow - Protected Access</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/esm/icons/index.js" type="module"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .auth-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
            padding: 20px;
        }
        .auth-card {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }
        .error-message {
            color: #d32f2f;
            background: #ffebee;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
            font-size: 14px;
        }
        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            margin-bottom: 20px;
            box-sizing: border-box;
        }
        .form-input:focus {
            outline: none;
            border-color: #1a237e;
        }
        .form-button {
            width: 100%;
            padding: 12px;
            background: #1a237e;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .form-button:hover {
            background: #3949ab;
        }
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #1a237e;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <script>
        // Password protection system
        class NATOAuth {
            constructor() {
                // Use a secure hash for the password - change this in production
                this.correctPasswordHash = 'a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3';
                this.sessionKey = 'nato_auth_session';
                this.maxAttempts = 5;
                this.lockoutTime = 15 * 60 * 1000; // 15 minutes
                this.init();
            }

            async init() {
                // Check if already authenticated
                const session = sessionStorage.getItem(this.sessionKey);
                if (session === 'authenticated' && !this.isLockedOut()) {
                    this.loadWorkflowApp();
                } else {
                    this.showAuthScreen();
                }
            }

            async hashPassword(password) {
                const encoder = new TextEncoder();
                const data = encoder.encode(password);
                const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            }

            async verifyPassword(password) {
                const hashedPassword = await this.hashPassword(password);
                return hashedPassword === this.correctPasswordHash;
            }

            getAttempts() {
                const attempts = localStorage.getItem('nato_attempts');
                return attempts ? JSON.parse(attempts) : { count: 0, lastAttempt: 0 };
            }

            setAttempts(count) {
                localStorage.setItem('nato_attempts', JSON.stringify({
                    count: count,
                    lastAttempt: Date.now()
                }));
            }

            isLockedOut() {
                const attempts = this.getAttempts();
                if (attempts.count >= this.maxAttempts) {
                    const timeSinceLastAttempt = Date.now() - attempts.lastAttempt;
                    if (timeSinceLastAttempt < this.lockoutTime) {
                        return true;
                    } else {
                        // Reset attempts after lockout period
                        this.setAttempts(0);
                        return false;
                    }
                }
                return false;
            }

            showAuthScreen() {
                const attempts = this.getAttempts();
                const remaining = this.maxAttempts - attempts.count;
                
                if (this.isLockedOut()) {
                    const timeLeft = Math.ceil((this.lockoutTime - (Date.now() - attempts.lastAttempt)) / 60000);
                    document.body.innerHTML = `
                        <div class="auth-screen">
                            <div class="auth-card">
                                <h2 style="margin: 0 0 20px 0; color: #d32f2f;">Access Temporarily Locked</h2>
                                <p style="color: #666;">Too many failed attempts. Please wait ${timeLeft} minutes before trying again.</p>
                                <button onclick="location.reload()" class="form-button" style="background: #666; margin-top: 20px;">Check Again</button>
                            </div>
                        </div>
                    `;
                    return;
                }

                document.body.innerHTML = `
                    <div class="auth-screen">
                        <div class="auth-card">
                            <h2 style="margin: 0 0 10px 0; color: #1a237e; font-size: 24px;">NATO M&S Workflow</h2>
                            <p style="margin: 0 0 30px 0; color: #666; font-size: 14px;">
                                This system contains sensitive project information<br>
                                <strong>Authorized Personnel Only</strong>
                            </p>
                            
                            <div id="error-message" class="error-message"></div>
                            
                            <form id="password-form">
                                <input 
                                    type="password" 
                                    id="password-input" 
                                    placeholder="Enter access code"
                                    class="form-input"
                                    required
                                    autocomplete="off"
                                />
                                <button 
                                    type="submit"
                                    id="login-button"
                                    class="form-button"
                                >
                                    Access System
                                </button>
                            </form>
                            
                            ${remaining <= 3 ? `
                                <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 6px;">
                                    <p style="margin: 0; font-size: 12px; color: #856404;">
                                        <strong>Warning:</strong> ${remaining} attempt${remaining !== 1 ? 's' : ''} remaining before 15-minute lockout
                                    </p>
                                </div>
                            ` : ''}
                            
                            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 6px; border: 1px solid #dee2e6;">
                                <p style="margin: 0; font-size: 12px; color: #6c757d; line-height: 1.4;">
                                    <strong>RFP-ACT-SACT-25-64</strong><br>
                                    AI Support to NATO M&S Lifecycle Automation<br>
                                    Interactive Workflow Visualization Tool
                                </p>
                            </div>
                        </div>
                    </div>
                `;

                const form = document.getElementById('password-form');
                const input = document.getElementById('password-input');
                const button = document.getElementById('login-button');
                const errorDiv = document.getElementById('error-message');

                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const password = input.value;

                    if (!password) return;

                    // Show loading state
                    button.innerHTML = '<div class="spinner"></div>Verifying...';
                    button.disabled = true;

                    try {
                        const isValid = await this.verifyPassword(password);
                        
                        if (isValid) {
                            sessionStorage.setItem(this.sessionKey, 'authenticated');
                            this.setAttempts(0); // Reset attempts on success
                            this.loadWorkflowApp();
                        } else {
                            const currentAttempts = this.getAttempts();
                            this.setAttempts(currentAttempts.count + 1);
                            
                            errorDiv.textContent = 'Invalid access code. Please try again.';
                            errorDiv.style.display = 'block';
                            input.value = '';
                            
                            // Check if this was the last attempt
                            if (currentAttempts.count + 1 >= this.maxAttempts) {
                                setTimeout(() => this.showAuthScreen(), 1000);
                            }
                        }
                    } catch (error) {
                        errorDiv.textContent = 'Authentication error. Please try again.';
                        errorDiv.style.display = 'block';
                    }

                    button.innerHTML = 'Access System';
                    button.disabled = false;
                });

                // Focus on input
                input.focus();
            }

            loadWorkflowApp() {
                // Show loading screen first
                document.body.innerHTML = `
                    <div style="display: flex; justify-content: center; align-items: center; min-height: 100vh; background: #f8f9fa;">
                        <div style="text-align: center;">
                            <div class="spinner" style="width: 40px; height: 40px; border-width: 4px; margin: 0 auto 20px auto;"></div>
                            <p style="color: #666; font-size: 18px; margin: 0;">Loading NATO M&S Workflow...</p>
                            <p style="color: #999; font-size: 14px; margin: 10px 0 0 0;">Initializing interactive visualization</p>
                        </div>
                    </div>
                `;

                // Load the React app after a brief delay
                setTimeout(() => {
                    this.initializeReactApp();
                }, 1500);
            }

            initializeReactApp() {
                // Create the root div for React
                document.body.innerHTML = '<div id="nato-workflow-root"></div>';
                
                // Initialize the React application
                const script = document.createElement('script');
                script.type = 'text/babel';
                script.innerHTML = `
                    const InteractiveWorkflow = () => {
                        return React.createElement('div', {
                            style: { 
                                minHeight: '100vh', 
                                background: '#f3f4f6', 
                                fontFamily: 'system-ui, -apple-system, sans-serif' 
                            }
                        }, 
                            React.createElement('div', {
                                style: {
                                    maxWidth: '1280px',
                                    margin: '0 auto',
                                    padding: '24px',
                                    textAlign: 'center'
                                }
                            },
                                React.createElement('h1', {
                                    style: {
                                        fontSize: '2rem',
                                        fontWeight: 'bold',
                                        color: '#1f2937',
                                        marginBottom: '16px'
                                    }
                                }, 'NATO M&S Workflow - Interactive Visualization'),
                                React.createElement('div', {
                                    style: {
                                        background: 'white',
                                        padding: '48px',
                                        borderRadius: '12px',
                                        boxShadow: '0 4px 6px rgba(0,0,0,0.1)',
                                        textAlign: 'left'
                                    }
                                },
                                    React.createElement('div', {
                                        style: {
                                            background: 'linear-gradient(135deg, #1a237e 0%, #3949ab 100%)',
                                            color: 'white',
                                            padding: '24px',
                                            borderRadius: '8px',
                                            marginBottom: '24px'
                                        }
                                    },
                                        React.createElement('h2', {
                                            style: { margin: '0 0 12px 0', fontSize: '1.5rem' }
                                        }, 'RFP-ACT-SACT-25-64: AI Support to NATO M&S Lifecycle'),
                                        React.createElement('p', {
                                            style: { margin: '0', opacity: '0.9' }
                                        }, 'Full automation design implementing NATO Annex C requirements to systematically determine AI capabilities and limits')
                                    ),
                                    React.createElement('div', {
                                        style: {
                                            background: '#fef3c7',
                                            border: '1px solid #f59e0b',
                                            padding: '16px',
                                            borderRadius: '8px',
                                            marginBottom: '24px'
                                        }
                                    },
                                        React.createElement('h3', {
                                            style: { margin: '0 0 8px 0', color: '#92400e' }
                                        }, 'ðŸš§ Loading Full Interactive Workflow...'),
                                        React.createElement('p', {
                                            style: { margin: '0', fontSize: '14px', color: '#92400e' }
                                        }, 'The complete React application with all 8 phases, expandable details, and interactive features is being loaded. This simplified view will be replaced momentarily.')
                                    ),
                                    React.createElement('div', {
                                        style: { 
                                            display: 'grid', 
                                            gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', 
                                            gap: '16px' 
                                        }
                                    },
                                        // Phase preview cards
                                        ...['Phase 0: Scenario Handoff', 'Phase 1: Requirements Analysis', 'Phase 2: Conceptual Model', 'Phase 3: Model Design', 'Phase 4: Implementation', 'Phase 5: Verification & Validation', 'Phase 6: Experimentation', 'Phase 7: Maintenance'].map((title, index) =>
                                            React.createElement('div', {
                                                key: index,
                                                style: {
                                                    background: '#f9fafb',
                                                    border: '1px solid #e5e7eb',
                                                    borderRadius: '8px',
                                                    padding: '16px'
                                                }
                                            },
                                                React.createElement('div', {
                                                    style: {
                                                        display: 'flex',
                                                        alignItems: 'center',
                                                        marginBottom: '8px'
                                                    }
                                                },
                                                    React.createElement('div', {
                                                        style: {
                                                            width: '32px',
                                                            height: '32px',
                                                            background: ['#9ca3af', '#22c55e', '#a855f7', '#eab308', '#ef4444', '#6366f1', '#14b8a6', '#6b7280'][index],
                                                            borderRadius: '50%',
                                                            display: 'flex',
                                                            alignItems: 'center',
                                                            justifyContent: 'center',
                                                            color: 'white',
                                                            fontWeight: 'bold',
                                                            fontSize: '14px',
                                                            marginRight: '12px'
                                                        }
                                                    }, index),
                                                    React.createElement('h4', {
                                                        style: { margin: '0', fontSize: '16px', fontWeight: '600' }
                                                    }, title)
                                                ),
                                                React.createElement('p', {
                                                    style: { margin: '0', fontSize: '14px', color: '#6b7280' }
                                                }, `NATO Annex C Phase ${index} automation with AI integration`)
                                            )
                                        )
                                    )
                                )
                            )
                        );
                    };

                    ReactDOM.render(
                        React.createElement(InteractiveWorkflow),
                        document.getElementById('nato-workflow-root')
                    );
                    
                    // Load the full workflow component after initial render
                    setTimeout(() => {
                        window.location.href = './workflow.html';
                    }, 3000);
                `;
                document.body.appendChild(script);
            }
        }

        // Initialize authentication when page loads
        window.addEventListener('load', () => {
            new NATOAuth();
        });
    </script>
</head>
<body>
    <!-- Content will be dynamically generated by JavaScript -->
</body>
</html>