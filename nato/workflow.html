<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NATO M&S Workflow - Interactive Visualization</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .scroll-mt-6 {
            scroll-margin-top: 1.5rem;
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="max-w-7xl mx-auto p-6 min-h-screen">
        <!-- Header -->
        <div class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">
                RFP-ACT-SACT-25-64: AI Support to NATO M&S Lifecycle
            </h1>
            <p class="text-gray-600">
                Full automation design implementing NATO Annex C requirements to systematically determine AI capabilities and limits
            </p>
            <div class="mt-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200 max-w-5xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="text-left">
                        <p class="text-sm text-blue-800 leading-relaxed mb-2">
                            <strong>RFP Context:</strong> NATO problem domain and statement will be provided <strong>1 October 2025</strong> per RFP Phase 2 requirements.
                        </p>
                        <p class="text-sm text-blue-800 leading-relaxed">
                            <strong>Full Automation Design:</strong> Each phase implements complete AI automation with zero human intervention.
                        </p>
                    </div>
                    <div class="text-left">
                        <p class="text-sm text-indigo-800 leading-relaxed mb-2">
                            <strong>Annex C Compliance:</strong> Phases 1-7 directly implement NATO's M&S lifecycle tasks.
                        </p>
                        <p class="text-sm text-indigo-800 leading-relaxed">
                            <strong>AI Failure Analysis:</strong> When automation fails, we capture exactly where and why.
                        </p>
                    </div>
                </div>
            </div>
            <p class="text-sm text-gray-500 mt-4">Click any phase to expand Annex C compliance and AI automation details</p>
        </div>

        <!-- Global Features -->
        <div class="mb-8 bg-gradient-to-r from-gray-50 to-blue-50 rounded-lg p-6 border border-gray-200">
            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                AI Automation Architecture Principles
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-white p-4 rounded border border-gray-200">
                    <h4 class="font-medium text-gray-800 mb-2">NATO Annex C Implementation</h4>
                    <p class="text-sm text-gray-600">Direct implementation of all seven NATO M&S lifecycle phases per RFP Annex C requirements.</p>
                </div>
                <div class="bg-white p-4 rounded border border-gray-200">
                    <h4 class="font-medium text-gray-800 mb-2">Full Automation Design Philosophy</h4>
                    <p class="text-sm text-gray-600">Zero human intervention design to systematically determine what AI can and cannot do.</p>
                </div>
                <div class="bg-white p-4 rounded border border-gray-200">
                    <h4 class="font-medium text-gray-800 mb-2">RFP-Compliant Architecture</h4>
                    <p class="text-sm text-gray-600">Modular pipeline designed for HQ SACT scenario input (1 October 2025).</p>
                </div>
                <div class="bg-white p-4 rounded border border-gray-200">
                    <h4 class="font-medium text-gray-800 mb-2">Empirical AI Boundary Testing</h4>
                    <p class="text-sm text-gray-600">Contract-based module integration with comprehensive logging.</p>
                </div>
            </div>
        </div>
        
        <!-- Phases Container -->
        <div id="phases-container" class="space-y-6"></div>

        <!-- Footer -->
        <div class="mt-12 text-center py-8 border-t border-gray-200">
            <p class="text-sm text-gray-500">
                NATO M&S Lifecycle Automation • RFP-ACT-SACT-25-64 • Interactive Workflow Visualization
            </p>
            <p class="text-xs text-gray-400 mt-2">
                This system demonstrates AI automation capabilities for NATO's Modeling & Simulation lifecycle requirements
            </p>
        </div>
    </div>

    <script>
        // Check authentication
        if (sessionStorage.getItem('nato_authenticated') !== 'true') {
            window.location.href = 'index.html';
        }

        // Global state
        let expandedPhase = null;

        // Phase data with comprehensive details
        const phases = [
            {
                id: 0,
                name: "Scenario Handoff (NATO Input Reception)",
                cli: "scenario_handoff",
                primaryInput: { file: "nato_input.{any}", description: "Raw scenario file from HQ SACT (provided 1 October 2025) - any format" },
                primaryOutput: { file: "nato_scenario.json", description: "Raw scenario passed through for Phase 1 processing" },
                color: "bg-gray-400",
                description: "Simple handoff point - receive NATO scenario and pass to Phase 1",
                phaseExplanation: "This is simply the moment when NATO hands over the scenario file. No processing occurs here - just receiving the input and making it available to Phase 1. All validation, parsing, and analysis happens in Phase 1 per Annex C requirements.",
                subProcesses: [
                    { name: "Receive File", type: "process", description: "Accept scenario file from HQ SACT in any format (PDF, Word, JSON, etc.)", transforms: "NATO input → Raw file available for processing" },
                    { name: "Stage for Processing", type: "process", description: "Make file available to Phase 1 without modification", transforms: "Raw file → Staged input for Phase 1" }
                ],
                dataFlow: {
                    input: "Any format scenario from NATO",
                    internal: "File receipt → Staging for Phase 1",
                    output: "Raw scenario ready for Annex C Phase 1 processing"
                }
            },
            {
                id: 1,
                name: "Problem Definition & Requirements Analysis",
                cli: "p1_requirements",
                primaryInput: { file: "nato_scenario.json", description: "Raw NATO scenario from Phase 0 handoff" },
                primaryOutput: { file: "requirements.json", description: "Complete problem definition with objectives, constraints, stakeholders, and NATO performance measures (KPI/MoE/MoP)" },
                color: "bg-green-500",
                description: "AI automation of Annex C Phase 1: complete problem definition including file processing, objectives identification, and performance measures",
                phaseExplanation: "This phase implements the complete NATO Annex C Phase 1 through AI automation. It starts by processing the raw NATO input (validation, parsing, format conversion), then extracts simulation objectives, defines key requirements and constraints, identifies stakeholders, and establishes NATO-standard performance measures (KPIs, MoEs, MoPs).",
                subProcesses: [
                    { name: "File Validation & Format Processing", type: "process", description: "Check file integrity, detect format (PDF/Word/JSON), convert to processable text", transforms: "Raw NATO file → Validated, parsed text content" },
                    { name: "Document Structure Analysis", type: "process", description: "Parse document structure, identify sections (situation, mission, execution, etc.)", transforms: "Text content → Structured document sections" },
                    { name: "Objectives Identification (Task 1.1)", type: "process", description: "NLP extraction of simulation objectives from mission statements and commander's intent", transforms: "Document sections → Structured objectives list" },
                    { name: "Requirements & Constraints Analysis (Task 1.2)", type: "process", description: "Extract key requirements, operational constraints, stakeholder roles, and environmental factors", transforms: "Document content → Requirements matrix with constraints" },
                    { name: "Performance Measures Establishment (Task 1.3)", type: "process", description: "Extract and classify KPIs (operational metrics), MoEs (mission effectiveness), MoPs (system performance)", transforms: "Requirements → Categorized NATO performance measures" },
                    { name: "Entity & Stakeholder Mapping", type: "process", description: "Map identified entities to NATO ontology IDs and establish stakeholder relationships", transforms: "Raw entities → Standardized NATO IDs with relationships" },
                    { name: "Requirements Integration & Validation", type: "decision", description: "Validate completeness of problem definition, check for contradictions, assess confidence", transforms: "All analysis components → Validated requirements package" }
                ],
                dataFlow: {
                    input: "Raw NATO scenario file (any format)",
                    internal: "File processing → Document analysis → Objectives extraction → Requirements analysis → Performance measures → Entity mapping → Integration validation",
                    output: "Complete problem definition with all Annex C Phase 1 deliverables"
                },
                annexCRequirements: {
                    title: "Problem Definition & Requirements Analysis",
                    requirements: [
                        { id: "1.1", text: "Identify the objectives of the simulation", status: "✅", coverage: "AI Steps: Extract mission objectives" },
                        { id: "1.2", text: "Define key requirements, constraints, and stakeholders", status: "✅", coverage: "AI Steps: Extract constraints and entities" },
                        { id: "1.3", text: "Establish performance measures (KPI, MoE, MoP)", status: "✅", coverage: "AI Steps: Classify and structure all three measure types" }
                    ]
                }
            },
            {
                id: 2,
                name: "Conceptual Model Development",
                cli: "p2_concept",
                primaryInput: { file: "requirements.json", description: "NATO requirements from Phase 1" },
                primaryOutput: { file: "concept_model.json", description: "Abstract system representation with entities, processes, interactions, assumptions, and scope" },
                color: "bg-purple-500",
                description: "AI automation of Annex C Phase 2: abstract system representation, entity identification, and scope definition",
                phaseExplanation: "This phase implements NATO Annex C Phase 2 by developing an abstract representation of the operational system, identifying key military entities and their interactions, and defining assumptions and scope. AI automation creates the conceptual blueprint that bridges operational requirements to executable simulation models.",
                subProcesses: [
                    { name: "Ontology Lookup", type: "process", description: "Pull canonical definitions (weapon types, unit hierarchies) from local ontology.db", transforms: "Entity IDs → Full entity definitions with properties" },
                    { name: "LLM Draft Entities/Processes", type: "process", description: "Generate JSON blocks for entities with attributes and process flow edges", transforms: "Requirements → Entity objects + Process flows" },
                    { name: "Scope & Assumption Engine", type: "process", description: "Insert spatial/temporal bounds and explicit simplifications list", transforms: "Raw model → Bounded model with assumptions" },
                    { name: "Consistency Checker", type: "decision", description: "Detect duplicate IDs, orphan processes, circular dependencies", transforms: "Model graph → Error report or Pass" }
                ],
                dataFlow: {
                    input: "requirements.json with objectives and KPIs",
                    internal: "Ontology enrichment → Entity generation → Scope definition → Consistency check",
                    output: "concept_model.json with complete abstract model"
                },
                annexCRequirements: {
                    title: "Conceptual Model Development",
                    requirements: [
                        { id: "2.1", text: "Develop an abstract representation of the system or problem", status: "✅", coverage: "AI Step: Generate entity class stubs with attributes" },
                        { id: "2.2", text: "Identify key entities, processes, and interactions", status: "✅", coverage: "AI Step: Draft interaction matrix (who can shoot/move/detect whom)" },
                        { id: "2.3", text: "Define assumptions, simplifications, and scope", status: "✅", coverage: "AI Steps: Insert spatial/temporal scope and list assumptions" }
                    ]
                }
            },
            {
                id: 3,
                name: "Model Design",
                cli: "p3_design",
                primaryInput: { file: "concept_model.json", description: "Abstract conceptual model from Phase 2" },
                primaryOutput: { file: "design_spec.json", description: "Structured design with modeling techniques, input parameters, algorithms, and data structures" },
                color: "bg-yellow-500",
                description: "AI automation of Annex C Phase 3: structured design translation, modeling technique selection, and parameter definition",
                phaseExplanation: "This phase implements NATO Annex C Phase 3 by translating the conceptual model into a structured technical design, automatically selecting appropriate modeling techniques (discrete event, agent-based, system dynamics), and defining input parameters, algorithms, and data structures required for implementation.",
                subProcesses: [
                    { name: "Heuristic Rulebank", type: "process", description: "IF entity-count > 500 THEN suggest agent-based; ELSE discrete-event", transforms: "Model stats → Initial approach recommendation" },
                    { name: "ML Classifier", type: "process", description: "XGBoost model outputs probability per design type; boosts or overrides heuristic", transforms: "Model features → Design type probabilities" },
                    { name: "Data-Schema Synthesizer", type: "process", description: "Auto-create class/property tables for entities; writes to schema.yaml", transforms: "Entity definitions → Data schemas" },
                    { name: "Parameter Seed Generator", type: "process", description: "Default numerical values (tick length, sensor ranges) from doctrine CSV", transforms: "Entity types → Initial parameter values" },
                    { name: "Design Review Gate", type: "decision", description: "Combine confidence + policy; set approach = high_fidelity if complex", transforms: "Design components → Final design decision" }
                ],
                dataFlow: {
                    input: "concept_model.json with entities and processes",
                    internal: "Heuristic rules → ML enhancement → Schema generation → Parameter defaults",
                    output: "design_spec.json with simulation approach, schemas, initial parameters"
                },
                annexCRequirements: {
                    title: "Model Design",
                    requirements: [
                        { id: "3.1", text: "Translate the conceptual model into a structured design", status: "✅", coverage: "AI Steps: Heuristic rules + ML classification for design approach" },
                        { id: "3.2", text: "Choose appropriate modelling techniques (e.g., discrete event, agent-based, system dynamics)", status: "✅", coverage: "AI Step: ML classifier outputs probability per design type" },
                        { id: "3.3", text: "Define input parameters, algorithms, and data structures", status: "✅", coverage: "AI Steps: Generate data schema YAML + seed parameters table" }
                    ]
                }
            },
            {
                id: 4,
                name: "Model Implementation",
                cli: "p4_codegen",
                primaryInput: { file: "design_spec.json", description: "Technical design specification from Phase 3" },
                primaryOutput: { file: "sim_build/ directory", description: "Complete executable simulation with integrated data sources and optimized performance" },
                secondaryOutputs: [
                    { file: "model.py", description: "Main simulation implementation" },
                    { file: "requirements.txt", description: "Integrated dependencies" },
                    { file: "tests_unit.py", description: "Automated test suite" },
                    { file: "build_report.json", description: "Performance optimization report" }
                ],
                color: "bg-red-500",
                description: "AI automation of Annex C Phase 4: model development, data integration, and performance optimization",
                phaseExplanation: "This phase implements NATO Annex C Phase 4 by developing executable simulation models using programming languages, integrating necessary data sources and computational methods, and optimizing for performance and scalability. AI automation demonstrates the capability to translate design specifications into fully functional simulation software.",
                subProcesses: [
                    { name: "Template Loader", type: "process", description: "Load skeleton SimPy/Mesa project with Jinja placeholders", transforms: "Design type → Code template selection" },
                    { name: "Code-LLM Fill-In", type: "process", description: "Fill entity classes, event handlers, parameters into template", transforms: "Template + Design → Populated Python code" },
                    { name: "Dependency Resolver", type: "process", description: "Scan code, build requirements.txt (versions pinned)", transforms: "Import statements → Dependency list" },
                    { name: "Unit-Scaffold Writer", type: "process", description: "Generate pytest cases for each public method", transforms: "Code methods → Test functions" },
                    { name: "Auto-Build Runner", type: "decision", description: "pip install, mypy, flake8, pytest; produce build_report.json", transforms: "Code + Tests → Pass/Fail report" },
                    { name: "Regenerate/SME", type: "process", description: "Try prompt variant once; if still fails, raise SME flag", transforms: "Failed code → Revised code or SME alert" }
                ],
                dataFlow: {
                    input: "design_spec.json with approach, schemas, parameters",
                    internal: "Template selection → Code generation → Dependency resolution → Test creation → Build validation",
                    output: "sim_build/ directory with executable simulation + build_report.json"
                },
                annexCRequirements: {
                    title: "Model Implementation",
                    requirements: [
                        { id: "4.1", text: "Develop the model/s using programming languages", status: "✅", coverage: "AI Step: Fill Jinja placeholders with code-LLM" },
                        { id: "4.2", text: "Integrate necessary data sources and computational methods", status: "✅", coverage: "AI Steps: Template loader + dependency resolver" },
                        { id: "4.3", text: "Optimize for performance and scalability", status: "✅", coverage: "AI Steps: Build runner + automated patch generation" }
                    ]
                }
            },
            {
                id: 5,
                name: "Verification & Validation (V&V)",
                cli: "p5_vv",
                primaryInput: { file: "sim_build/ directory", description: "Complete simulation implementation from Phase 4" },
                primaryOutput: { file: "vv_report.json", description: "Verification results (correct build) and validation results (real-world accuracy) with confidence assessments" },
                color: "bg-indigo-500",
                description: "AI automation of Annex C Phase 5: verification (correct build) and validation (real-world accuracy)",
                phaseExplanation: "This phase implements NATO Annex C Phase 5 through automated verification (ensuring models are built correctly via debugging, code reviews, unit testing) and validation (ensuring models accurately represent real-world systems by comparing outputs with empirical data). AI automation tests the limits of autonomous quality assurance in military simulation.",
                subProcesses: [
                    { name: "Unit Tests", type: "process", description: "Execute scaffold; must be 100% pass", transforms: "Test suite → Pass/Fail per test" },
                    { name: "Smoke Scenario Run", type: "process", description: "60-second miniature sim; abort if crashes", transforms: "Simulation → Runtime stability check" },
                    { name: "Statistical Fit", type: "process", description: "Compare output metrics to baseline via KS-test/χ²; score 0-1", transforms: "Sim outputs → Statistical comparison scores" },
                    { name: "Face-Validity Heuristics", type: "process", description: "Quick plausibility checks (e.g., casualties not negative)", transforms: "Output values → Sanity check results" },
                    { name: "Aggregate Validator", type: "decision", description: "Combine results; set overall confidence, list issues[]", transforms: "All test results → Combined V&V score + issues" }
                ],
                dataFlow: {
                    input: "sim_build/ with model.py and tests",
                    internal: "Unit testing → Runtime check → Statistical validation → Plausibility check → Aggregation",
                    output: "vv_report.json with confidence score and issues list"
                },
                annexCRequirements: {
                    title: "Verification & Validation (V&V)",
                    requirements: [
                        { id: "5.1", text: "Verification: Ensure the model/s is/are built correctly (debugging, code reviews, unit testing)", status: "✅", coverage: "AI Steps: Unit tests + smoke scenario run" },
                        { id: "5.2", text: "Validation: Ensure the model/s accurately represents the real-world system", status: "✅", coverage: "AI Steps: Statistical fit + face-validity heuristics" }
                    ]
                }
            },
            {
                id: 6,
                name: "Experimentation & Analysis",
                cli: "p6_experiment",
                primaryInput: { file: "sim_build/ + requirements.json", description: "Validated simulation + NATO requirements" },
                primaryOutput: { file: "analysis_results/ directory", description: "NATO doctrinal scenarios, experimental results, and analytical insights" },
                secondaryOutputs: [
                    { file: "nato_scenarios.json", description: "Blue/Red/Green force scenarios per doctrine" },
                    { file: "runs.csv", description: "All simulation runs with sensitivity analysis" },
                    { file: "charts/*.png", description: "Result visualizations and effectiveness assessments" },
                    { file: "analysis_report.json", description: "Interpreted results and improvement recommendations" }
                ],
                color: "bg-teal-500",
                description: "AI automation of Annex C Phase 6: NATO doctrinal scenario development, experimental design, sensitivity analysis, and results interpretation",
                phaseExplanation: "This phase implements NATO Annex C Phase 6 by developing scenarios with proper Blue/Red/Green force structures per NATO doctrine, designing and conducting simulation experiments with sensitivity analysis, interpreting results to assess model effectiveness, and identifying areas for improvement. AI automation demonstrates autonomous capability for comprehensive operational analysis.",
                subProcesses: [
                    { name: "NATO Doctrine Parser", type: "process", description: "Extract Blue/Red/Green force doctrine from NATO database per Annex C 6.1 requirements", transforms: "Doctrine DB + Requirements → NATO force doctrine JSON" },
                    { name: "Force Structure Generator", type: "process", description: "Generate NATO-compliant force layouts with proper Blue/Red/Green designations", transforms: "Force Doctrine → NATO Scenario Structure" },
                    { name: "DoE Planner", type: "process", description: "Generate Latin-Hypercube sample of key parameters respecting KPI ranges", transforms: "Parameter space → Experiment design matrix" },
                    { name: "Parallel Runner", type: "process", description: "Spawn N worker procs; each runs sim + dumps run-level CSV", transforms: "Design matrix → Multiple simulation outputs" },
                    { name: "KPI Extractor", type: "process", description: "Post-process logs into runs.csv with KPI columns", transforms: "Raw outputs → Structured KPI table" },
                    { name: "ML Post-analysis", type: "process", description: "Random forest/SHAP to rank parameter importance; cluster outcomes", transforms: "KPI data → Feature importance + clusters" },
                    { name: "Chart Render", type: "process", description: "Matplotlib PNGs: KPI distributions, pareto fronts", transforms: "Data → Visualization files" },
                    { name: "Insight Synthesizer", type: "process", description: "Summarize top 5 findings in analysis_report.json", transforms: "All results → Key insights document" }
                ],
                dataFlow: {
                    input: "sim_build/ code + requirements.json KPIs",
                    internal: "NATO doctrine parsing → Force structure generation → DoE planning → Parallel execution → KPI extraction → ML analysis → Visualization → Synthesis",
                    output: "analysis_results/ with runs.csv, charts, and analysis_report.json"
                },
                annexCRequirements: {
                    title: "Experimentation & Analysis",
                    requirements: [
                        { id: "6.1", text: "Develop the scenario (in accordance with doctrine: Blue, Red and Green/White)", status: "✅", coverage: "AI Steps: NATO Doctrine Parser + Force Structure Generator" },
                        { id: "6.2", text: "Design of experiment to cover the problem statement and KPI", status: "✅", coverage: "AI Step: DoE planner script" },
                        { id: "6.3", text: "Conduct simulation runs and sensitivity analysis", status: "✅", coverage: "AI Steps: Parallel runner + KPI extractor" },
                        { id: "6.4", text: "Interpret results and assess the model's/models' effectiveness", status: "✅", coverage: "AI Steps: SHAP analysis + chart renderer" },
                        { id: "6.5", text: "Identify areas for improvement", status: "✅", coverage: "AI Step: Summarize top 5 insights with recommendations" }
                    ]
                }
            },
            {
                id: 7,
                name: "Maintenance & Evolution",
                cli: "p7_maintenance",
                primaryInput: { file: "analysis_results/ + prior run_meta.json", description: "Current analysis results + historical baselines" },
                primaryOutput: { file: "maintenance_actions.json", description: "Model update recommendations based on new data, technologies, or requirements" },
                secondaryOutputs: [
                    { file: "updated_design_spec.json", description: "Revised parameters and specifications" },
                    { file: "evolution_log.json", description: "Change tracking and rationale" }
                ],
                color: "bg-gray-500",
                description: "AI automation of Annex C Phase 7: model updates based on new data, technologies, or requirements",
                phaseExplanation: "This phase implements NATO Annex C Phase 7 by automatically updating models based on new data, technologies, or evolving requirements. AI automation monitors model performance over time, detects drift from baseline expectations, and recommends appropriate updates to maintain model relevance and accuracy in changing operational environments.",
                subProcesses: [
                    { name: "Baseline Compare", type: "process", description: "Load historical KPI means; compute z-scores for new run", transforms: "Current + Historical → Deviation metrics" },
                    { name: "Drift Detector", type: "process", description: "Two-sample tests; flag if p < 0.05 on > 30% of KPIs", transforms: "Deviations → Statistical significance flags" },
                    { name: "Version Recommender", type: "process", description: "Suggest 'retune params' vs 'regen design' vs 'full rebuild'", transforms: "Drift analysis → Action recommendation" },
                    { name: "Auto-Patch Draft", type: "process", description: "If retune, output updated design_spec.json with new param seeds", transforms: "Recommendation → Updated specifications" }
                ],
                dataFlow: {
                    input: "analysis_results/ + historical run_meta.json",
                    internal: "Baseline comparison → Drift detection → Action recommendation → Patch generation",
                    output: "maintenance_actions.json (+ optional updated_design_spec.json)"
                },
                annexCRequirements: {
                    title: "Maintenance & Evolution",
                    requirements: [
                        { id: "7.1", text: "Update the model/s based on new data, technologies, or requirements", status: "✅", coverage: "AI Steps: Action recommender + auto-patch draft" }
                    ]
                }
            }
        ];

        function getProcessIcon(type) {
            switch (type) {
                case 'decision': return '⚠️';
                case 'process': return '⚙️';
                default: return '🔧';
            }
        }

        function getProcessColor(type) {
            switch (type) {
                case 'decision': return 'border-yellow-400 bg-yellow-50';
                case 'process': return 'border-blue-400 bg-blue-50';
                default: return 'border-gray-400 bg-gray-50';
            }
        }

        function renderPhases() {
            const container = document.getElementById('phases-container');
            container.innerHTML = '';

            phases.forEach(phase => {
                const phaseDiv = document.createElement('div');
                phaseDiv.className = 'scroll-mt-6';
                phaseDiv.id = `phase-${phase.id}`;

                const isExpanded = expandedPhase === phase.id;
                
                phaseDiv.innerHTML = `
                    <!-- Phase Header -->
                    <div class="bg-white border-2 ${isExpanded ? 'border-blue-400 shadow-lg' : 'border-gray-200 hover:border-gray-300'} rounded-lg transition-all cursor-pointer" onclick="togglePhase(${phase.id})">
                        <div class="p-6">
                            <div class="flex items-start gap-4">
                                <div class="w-14 h-14 ${phase.color} rounded-full flex items-center justify-center text-white font-bold text-xl flex-shrink-0">
                                    ${phase.id}
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center gap-3 mb-2">
                                        <h3 class="text-xl font-semibold text-gray-800">${phase.name}</h3>
                                        <code class="text-sm bg-gray-100 px-2 py-1 rounded font-mono">${phase.cli}</code>
                                    </div>
                                    <p class="text-gray-600 mb-3">${phase.description}</p>
                                    
                                    <!-- Input/Output Preview -->
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                                        <div class="bg-blue-50 p-3 rounded-lg">
                                            <div class="flex items-center gap-2 mb-1">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                                </svg>
                                                <span class="text-sm font-medium text-blue-800">Input:</span>
                                            </div>
                                            <code class="text-xs block text-blue-700">${phase.primaryInput.file}</code>
                                        </div>
                                        
                                        <div class="flex items-center justify-center">
                                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                            </svg>
                                        </div>
                                        
                                        <div class="bg-green-50 p-3 rounded-lg">
                                            <div class="flex items-center gap-2 mb-1">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                                </svg>
                                                <span class="text-sm font-medium text-green-800">Output:</span>
                                            </div>
                                            <code class="text-xs block text-green-700">${phase.primaryOutput.file}</code>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex-shrink-0">
                                    <svg class="w-5 h-5 text-gray-400 ${isExpanded ? 'rotate-180' : ''} transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                            </div>
                        </div>

                        ${isExpanded ? `
                        <!-- Expanded Content -->
                        <div class="border-t border-gray-200 bg-gray-50 p-6 space-y-6 animate-fade-in">
                            ${phase.phaseExplanation ? `
                            <!-- Phase Explanation -->
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <p class="text-gray-700 leading-relaxed">${phase.phaseExplanation}</p>
                            </div>
                            ` : ''}

                            <!-- CLI Command Example -->
                            <div class="bg-gray-800 text-green-400 p-4 rounded-lg font-mono text-sm">
                                <span class="text-gray-400">$</span> python ${phase.cli}.py ${phase.primaryInput.file}
                            </div>

                            <!-- Input/Output Specification -->
                            <div class="bg-white border border-gray-200 rounded-lg p-6">
                                <h3 class="font-semibold mb-4 flex items-center gap-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    Module Interface Specification
                                </h3>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Input -->
                                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                        <h4 class="font-medium text-blue-900 mb-3 flex items-center gap-2">
                                            📄 Primary Input
                                        </h4>
                                        <code class="block text-sm bg-white px-3 py-2 rounded mb-2 border border-blue-200">
                                            ${phase.primaryInput.file}
                                        </code>
                                        <p class="text-sm text-blue-800">${phase.primaryInput.description}</p>
                                    </div>
                                    
                                    <!-- Output -->
                                    <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                        <h4 class="font-medium text-green-900 mb-3 flex items-center gap-2">
                                            📊 Primary Output
                                        </h4>
                                        <code class="block text-sm bg-white px-3 py-2 rounded mb-2 border border-green-200">
                                            ${phase.primaryOutput.file}
                                        </code>
                                        <p class="text-sm text-green-800">${phase.primaryOutput.description}</p>
                                        
                                        ${phase.secondaryOutputs ? `
                                        <div class="mt-3 pt-3 border-t border-green-300">
                                            <p class="text-xs text-green-700 font-medium mb-2">Additional outputs:</p>
                                            ${phase.secondaryOutputs.map(output => `
                                                <div class="text-xs text-green-700 mb-1">
                                                    <code class="bg-white px-2 py-0.5 rounded">${output.file}</code>
                                                    <span class="ml-2">- ${output.description}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>

                            <!-- Data Flow -->
                            <div class="bg-gradient-to-r from-blue-50 to-green-50 border border-gray-200 rounded-lg p-6">
                                <h3 class="font-semibold mb-4 flex items-center gap-2">
                                    ⚡ Data Transformation Flow
                                </h3>
                                <div class="bg-white rounded-lg p-4 border border-gray-200">
                                    <div class="space-y-3">
                                        <div class="flex items-center gap-3">
                                            <span class="text-sm font-medium text-blue-700 w-20">Input:</span>
                                            <span class="text-sm text-gray-700 flex-1">${phase.dataFlow.input}</span>
                                        </div>
                                        <div class="flex items-center gap-3">
                                            <span class="text-sm font-medium text-purple-700 w-20">Process:</span>
                                            <span class="text-sm text-gray-700 flex-1">${phase.dataFlow.internal}</span>
                                        </div>
                                        <div class="flex items-center gap-3">
                                            <span class="text-sm font-medium text-green-700 w-20">Output:</span>
                                            <span class="text-sm text-gray-700 flex-1">${phase.dataFlow.output}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Internal Processes -->
                            <div class="bg-white border border-gray-200 rounded-lg p-6">
                                <h3 class="font-semibold mb-4 flex items-center gap-2">
                                    ⚙️ Internal Processes
                                </h3>
                                <div class="space-y-4">
                                    ${phase.subProcesses.map((subprocess, idx) => `
                                        <div class="border-2 ${getProcessColor(subprocess.type)} rounded-lg p-4">
                                            <div class="flex items-start gap-3">
                                                <div class="w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${
                                                    subprocess.type === 'decision' ? 'bg-yellow-200 text-yellow-800' :
                                                    subprocess.type === 'process' ? 'bg-blue-200 text-blue-800' :
                                                    'bg-gray-200 text-gray-800'
                                                }">
                                                    ${getProcessIcon(subprocess.type)}
                                                </div>
                                                <div class="flex-1">
                                                    <h6 class="font-medium text-gray-800 mb-1">${subprocess.name}</h6>
                                                    <p class="text-sm text-gray-600 mb-2">${subprocess.description}</p>
                                                    ${subprocess.transforms ? `
                                                        <div class="bg-white p-2 rounded border border-gray-200">
                                                            <p class="text-xs text-gray-700">
                                                                <span class="font-medium">Transform:</span> ${subprocess.transforms}
                                                            </p>
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>

                            ${phase.annexCRequirements && phase.id > 0 ? `
                            <!-- NATO Annex C Requirements Compliance -->
                            <div class="bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-6">
                                <h3 class="font-semibold mb-4 flex items-center gap-2 text-green-800">
                                    ✅ NATO Annex C Phase ${phase.id} Implementation
                                </h3>
                                <div class="bg-white rounded-lg p-4 border border-green-200 mb-6">
                                    <h4 class="font-medium text-green-900 mb-3">${phase.annexCRequirements.title}</h4>
                                    <p class="text-sm text-gray-700 mb-4">Each requirement below shows the specific AI automation steps that implement it:</p>
                                </div>
                                
                                <div class="space-y-4">
                                    ${phase.annexCRequirements.requirements.map((req, reqIndex) => `
                                        <div class="bg-white border border-green-200 rounded-lg p-6">
                                            <div class="flex items-start gap-4 mb-4">
                                                <div class="flex-shrink-0">
                                                    <div class="inline-flex items-center justify-center w-12 h-12 bg-green-100 text-green-800 rounded-full text-lg font-bold border-2 border-green-300">
                                                        ${req.id}
                                                    </div>
                                                </div>
                                                <div class="flex-1">
                                                    <div class="flex items-center gap-2 mb-2">
                                                        <span class="text-xl">${req.status}</span>
                                                        <span class="text-lg font-semibold text-gray-900">Requirement ${req.id}</span>
                                                    </div>
                                                    <p class="text-base text-gray-800 font-medium mb-3">${req.text}</p>
                                                    <div class="bg-green-50 p-3 rounded border border-green-200">
                                                        <span class="text-sm font-medium text-green-800">AI Implementation Overview:</span>
                                                        <div class="text-sm text-green-700 mt-1">${req.coverage}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                                
                                <div class="mt-6 p-4 bg-green-100 rounded border border-green-300">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-sm font-medium text-green-900">✅ Phase ${phase.id} Compliance Status</span>
                                    </div>
                                    <p class="text-xs text-green-800 leading-relaxed">
                                        <strong>✅ Fully Compliant:</strong> All NATO Annex C Phase ${phase.id} requirements are explicitly addressed through specific AI automation steps. 
                                        Each requirement has direct AI implementation with measurable outputs that NATO can evaluate for automation capability assessment.
                                    </p>
                                </div>
                            </div>
                            ` : ''}
                        </div>
                        ` : ''}
                    </div>
                `;

                container.appendChild(phaseDiv);
            });
        }

        function togglePhase(phaseId) {
            expandedPhase = expandedPhase === phaseId ? null : phaseId;
            renderPhases();
            
            if (expandedPhase !== null) {
                setTimeout(() => {
                    const element = document.getElementById(`phase-${phaseId}`);
                    if (element) {
                        element.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }, 100);
            }
        }

        // Initialize the application
        renderPhases();
    </script>
</body>
</html>